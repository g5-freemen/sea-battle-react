(this["webpackJsonpsea-battle"]=this["webpackJsonpsea-battle"]||[]).push([[0],{18:function(e,t,n){},21:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),i=n(10),c=n.n(i),s=n(3),l=(n(18),n(2)),o={ru:{gameTitle:"\u041c\u043e\u0440\u0441\u043a\u043e\u0439 \u0431\u043e\u0439",arrangeShips:"\u0420\u0430\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u043a\u043e\u0440\u0430\u0431\u043b\u0435\u0439",arrangeShipsManual:"\u0412\u0440\u0443\u0447\u043d\u0443\u044e",arrangeShipsAuto:"\u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438",remarkLBtn:"\u041a\u043b\u0438\u043a\u043d\u0438\u0442\u0435 \u043d\u0430 \u043a\u043e\u0440\u0430\u0431\u043b\u044c \u043b\u0435\u0432\u043e\u0439 \u043a\u043d\u043e\u043f\u043a\u043e\u0439 \u043c\u044b\u0448\u0438 \u0447\u0442\u043e\u0431\u044b \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0435\u0433\u043e",remarkRBtn:"\u041a\u043b\u0438\u043a\u043d\u0438\u0442\u0435 \u043d\u0430 \u043a\u043e\u0440\u0430\u0431\u043b\u044c \u043f\u0440\u0430\u0432\u043e\u0439 \u043a\u043d\u043e\u043f\u043a\u043e\u0439 \u043c\u044b\u0448\u0438 \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u0435\u0433\u043e",playerTurn:"\u0412\u0430\u0448 \u0445\u043e\u0434!",compTurn:"\u0425\u043e\u0434 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430!",begin:"\u0414\u0430 \u043d\u0430\u0447\u043d\u0451\u0442\u0441\u044f \u0431\u0438\u0442\u0432\u0430!",playerHits:"\u0412\u044b \u043f\u043e\u043f\u0430\u043b\u0438!",playerMissed:"\u0412\u044b \u043f\u0440\u043e\u043c\u0430\u0445\u043d\u0443\u043b\u0438\u0441\u044c!",compHits:"\u041a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440 \u043f\u043e\u043f\u0430\u043b!",compMissed:"\u041a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440 \u043f\u0440\u043e\u043c\u0430\u0445\u043d\u0443\u043b\u0441\u044f!",winPlayer:"\u0412\u044b \u043f\u043e\u0431\u0435\u0434\u0438\u043b\u0438!",winComp:"\u041a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440 \u043f\u043e\u0431\u0435\u0434\u0438\u043b!"},en:{gameTitle:"Sea Battle",arrangeShips:"Arrange Ships",arrangeShipsManual:"Manual",arrangeShipsAuto:"Automatic",remarkLBtn:"Click left mouse button on the ship to select it",remarkRBtn:"Click right mouse button on the ship to rotate it",playerTurn:"Your turn!",compTurn:"Computer turn!",begin:"Fight!",playerHits:"Hit the target!",playerMissed:"Miss the target!",compHits:"Computer Hit the target!",compMissed:"Computer Miss the target!",winPlayer:"You Win!",winComp:"Computer Win!"}},u=n(5),p=n.p+"static/media/hit.8c96d676.mp3",d=n.p+"static/media/miss.b9a5893c.mp3",m=n.p+"static/media/fight.15e2f926.mp3",f=n.p+"static/media/winComp.f369007a.mp3",b=n.p+"static/media/winPlayer.4834e938.mp3",j=n(0),g=r.a.createContext({}),h=g.Provider;function O(e){var t=e.children,n=Object(a.useState)(!0),r=Object(l.a)(n,2),i=r[0],c=r[1],g=Object(a.useState)("begin"),O=Object(l.a)(g,2),y=O[0],v=O[1],x=Object(a.useState)(Array(10).fill("-").map((function(){return Array(10).fill("-")}))),S=Object(l.a)(x,2),C=S[0],w=S[1],N=Object(a.useState)(Array(10).fill("-").map((function(){return Array(10).fill("-")}))),M=Object(l.a)(N,2),k=M[0],T=M[1],A=Object(a.useState)({}),R=Object(l.a)(A,2),F=R[0],E=R[1],H=Object(a.useState)(null),P=Object(l.a)(H,2),L=P[0],D=P[1],X=Object(a.useState)(null),U=Object(l.a)(X,2),_=U[0],q=U[1],Y=Object(a.useState)("begin"),J=Object(l.a)(Y,2),W=J[0],I=J[1],K=Object(a.useState)(0),z=Object(l.a)(K,2),G=z[0],Q=z[1],V=Object(a.useState)(window.navigator.language.includes("ru")?"ru":"en"),Z=Object(l.a)(V,2),$=Z[0],ee=Z[1],te=Object(a.useState)(!1),ne=Object(l.a)(te,2),ae=ne[0],re=ne[1];Object(a.useEffect)((function(){if(G>0&&!ae){var e=JSON.stringify({playerBF:C,compBF:k});B.dispatch({type:"ADD_TURN",payload:e})}}),[G]);var ie=Object(u.a)(p),ce=Object(l.a)(ie,1)[0],se=Object(u.a)(d),le=Object(l.a)(se,1)[0],oe=Object(u.a)(m),ue=Object(l.a)(oe,1)[0],pe=Object(u.a)(f),de=Object(l.a)(pe,1)[0],me=Object(u.a)(b),fe=Object(l.a)(me,1)[0];function be(e){var t={top:e.top,bottom:e.bottom,left:e.left,right:e.right,width:e.width,height:e.height,gridCol:new Array(11).fill(0).map((function(t,n){return e.left+n*e.width/10})),gridRow:new Array(11).fill(0).map((function(t,n){return e.top+n*e.height/10}))};E(t)}return Object(a.useEffect)((function(){var e=document.querySelector(".battlefield-pad").getBoundingClientRect();!function(){for(var e=0,t=0,n=[[1,4],[2,3],[3,2],[4,1]];t<n.length;t++)for(var a=n[t],r=function(t){var n={num:e++,length:a[1]};D((function(e){return e?e.concat(n):[n]})),q((function(e){return e?e.concat(n):[n]}))},i=0;i<a[0];i++)r()}(),be(e)}),[]),Object(a.useEffect)((function(){i||be(document.querySelectorAll(".battlefield-pad")[1].getBoundingClientRect())}),[i]),Object(j.jsx)(h,{value:{arrangeShips:i,setArrangeShips:c,arrangeShipsMode:y,setArrangeShipsMode:v,playerBF:C,setPlayerBF:w,compBF:k,setCompBF:T,playerShips:L,setPlayerShips:D,compShips:_,setCompShips:q,bfCoord:F,message:o,lang:$,setLang:ee,turn:W,setTurn:I,turnNum:G,setTurnNum:Q,timeMachine:ae,setTimeMachine:re,getRnd:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e<1||e>10;)e=Math.ceil(10*Math.random());return e},playHit:ce,playMiss:le,playFight:ue,checkWinner:function(){(W.includes("comp")||"player"===W)&&(0===Object(s.a)(C).flat().filter((function(e){return e===+e})).length&&(I("winComp"),de()),0===Object(s.a)(k).flat().filter((function(e){return e===+e})).length&&(I("winPlayer"),fe()))},store:B},children:t})}var y=n(4),v=n.n(y);function x(e){var t=e.length,n=e.num,r=Object(a.useContext)(g),i=r.setPlayerShips,c=r.setCompShips,o=r.compBF,u=r.setCompBF,p=r.bfCoord,d=r.playerBF,m=r.setPlayerBF,f=r.arrangeShipsMode,b=r.getRnd,h=Object(a.useState)("auto"===f&&Math.random()>.5),O=Object(l.a)(h,2),y=O[0],x=O[1];function S(e,a,r,l){for(var p=!0,j=0;j<t;j++)try{l?(y||"-"===o[a-1][e-1+j]||(p=!1),y&&"-"!==o[a-1+j][e-1]&&(p=!1)):(y||"-"===d[a-1][e-1+j]||(p=!1),y&&"-"!==d[a-1+j][e-1]&&(p=!1))}catch(N){p=!1}if(p){for(var g=l?Object(s.a)(o):Object(s.a)(d),h=0;h<t;h++)y?g[a-1+h][e-1]=n:g[a-1][e-1+h]=n;for(var O=0;O<3;O++)for(var v=0;v<t+2;v++){var x=void 0,C=void 0;if(y?(x=a-2+v,C=e-2+O):(x=a-2+O,C=e-2+v),!(x<0||C<0||x>9||C>9)){var w=g[x][C];void 0!==w&&w!==+w&&"D"!==w&&(g[x][C]="D")}}l?(u(g),c((function(e){return e.filter((function(e){return e.num!==n}))}))):(m(g),i((function(e){return e.filter((function(e){return e.num!==n}))}))),document.onmousemove=null,r&&(r.onmouseup=null)}p||(l||"auto"!==f?l&&S(b(),b(),null,!0):S(b(),b(),null))}return Object(a.useEffect)((function(){"auto"===f&&setTimeout((function(){d.toString().includes(n)||S(b(),b(),null)}),500*n),o.toString().includes(n)||S(b(),b(),null,!0)}),[d,o]),Object(j.jsx)("span",{className:"ship",id:v()(),style:y?{width:33,height:33*t}:{width:33*t,height:33},onDragStart:function(){return!1},onMouseDown:function(e){if(0===e.button){var t=e.target,n=t.getBoundingClientRect(),a=e.pageX-n.left,r=e.pageY-n.top;t.style.position="absolute",t.style.zIndex=9,i(e),document.onmousemove=function(e){return i(e)},t.onmouseup=function(e){for(var n,a,r=e.target.closest(".ship").getBoundingClientRect(),i=0;i<p.gridCol.length-1;i++)r.x>=p.gridCol[i]&&r.x<=p.gridCol[i+1]&&(n=i+1),r.y>=p.gridRow[i]&&r.y<=p.gridRow[i+1]&&(a=i+1);void 0===n||void 0===a||n<1||a<1||"auto"!==f&&S(n,a,t)}}function i(e){t.style.left=e.pageX-a+"px",t.style.top=e.pageY-r+"px"}},onContextMenu:function(e){e.preventDefault(),x((function(e){return!e}))}})}function S(){var e=Object(a.useContext)(g),t=e.lang,n=e.message,r=e.playerShips,i=e.arrangeShipsMode,c=e.setArrangeShipsMode,s=e.setArrangeShips;return document.addEventListener("keydown",(function(e){"1"===e.key?c("manual"):"2"===e.key&&c("auto")})),Object(a.useEffect)((function(){r&&0===r.length&&c("playerReady")}),[r]),Object(a.useEffect)((function(){"playerReady"===i&&s(!1)}),[i]),Object(j.jsxs)("div",{className:"battlefield-menu",children:[("begin"===i||"manual"===i||"auto"===i)&&Object(j.jsxs)("p",{className:"battlefield-menu--title",children:[n[t].arrangeShips,"en"===t&&"begin"!==i&&Object(j.jsxs)("span",{children:[": ",i]}),"ru"===t&&"manual"===i&&Object(j.jsx)("span",{children:": \u0432\u0440\u0443\u0447\u043d\u0443\u044e"}),"ru"===t&&"auto"===i&&Object(j.jsx)("span",{children:": \u0430\u0432\u0442\u043e"})]}),"manual"===i&&Object(j.jsxs)("span",{className:"battlefield-menu--remark",children:[n[t].remarkLBtn," ",Object(j.jsx)("br",{}),n[t].remarkRBtn]}),"begin"===i&&Object(j.jsxs)("ul",{className:"battlefield-menu--list",children:[Object(j.jsxs)("li",{onClick:function(){return c("manual")},children:["1) ",n[t].arrangeShipsManual]}),Object(j.jsxs)("li",{onClick:function(){return c("auto")},children:["2) ",n[t].arrangeShipsAuto]})]}),("manual"===i||"auto"===i)&&Object(j.jsx)("div",{className:"battlefield-menu--ships",children:r.map((function(e){return Object(j.jsx)(x,{length:e.length,num:e.num},v()())}))})]})}function C(e){var t=e.type,n=Object(a.useContext)(g).lang;return Object(j.jsx)("div",{className:"battlefield-"+t,children:[1,2,3,4,5,6,7,8,9,10].map((function(e){return Object(j.jsx)("span",{className:"idx",style:"digits"===t?{gridColumn:e}:{gridRow:e},children:"digits"===t?e:"ru"===n?10!==e?String.fromCharCode(e+1039):"\u041a":String.fromCharCode(e+64)},v()())}))})}function w(){var e=Object(a.useContext)(g),t=e.message,n=e.bfCoord,r=e.checkWinner,i=e.lang,c=e.compBF,o=e.setCompBF,u=e.playerBF,p=e.setPlayerBF,d=e.getRnd,m=e.turn,f=e.setTurn,b=e.turnNum,h=e.setTurnNum,O=e.playHit,y=e.playMiss,x=e.playFight,S=e.store,C=e.timeMachine,w=e.setTimeMachine,N=Object(a.useState)(null),M=Object(l.a)(N,2),B=M[0],k=M[1],T=Object(a.useState)(null),A=Object(l.a)(T,2),R=A[0],F=A[1],E=document.querySelectorAll(".battlefield-pad");function H(e){for(var t,a,r=e.clientX,i=e.clientY,c=0;c<n.gridCol.length-1;c++)r>=n.gridCol[c]&&r<=n.gridCol[c+1]&&(t=c+1),i>=n.gridRow[c]&&i<=n.gridRow[c+1]&&(a=c+1);P(t,a)}function P(e,t){if(0===Object(s.a)(u).flat().filter((function(e){return e===+e})).length||0===Object(s.a)(c).flat().filter((function(e){return e===+e})).length)return r(),document.body.style.cursor="auto",void(E[1].style.cursor="pointer");if(e&&t||(e=d(),t=d()),m.includes("comp")&&null!==R){var n=Object(s.a)(u);if(n.flat().toString().includes(R)){if(Math.random()<.4){for(var a=!1,i=0;i<n.length;i++)for(var l=0;l<n[i].length;l++)if(n[i][l]===R&&!a){O(),n[i][l]="X";var b=m+v()();f(b),a=!0}return F(null),void p(n)}F(null)}}var j="player"===m?Object(s.a)(c):Object(s.a)(u),g=j[t-1][e-1];if(+g===g){if(m.includes("comp")&&F(g),j[t-1][e-1]="X",O(),"player"===m?o(j):p(j),k("player"===m?"playerHits":"compHits"),m.includes("comp")){var h=m+v()();setTimeout((function(){return f(h)}),999)}}else{if("X"===g||"*"===g){if(m.includes("comp")){var x=m+v()();f(x)}return}j[t-1][e-1]="*",y(),"player"===m?o(j):p(j),k("player"===m?"playerMissed":"compMissed"),setTimeout((function(){"player"===m?f("comp"):m.includes("comp")&&f("player")}),999)}}return Object(a.useEffect)((function(){if(!m.includes("player"))try{E.length>1&&E[1].removeEventListener("click",H)}catch(e){console.log(e)}m.includes("win")||r(),"begin"===m&&(x(),setTimeout(f.bind(null,"player"),2e3)),m.includes("player")&&(document.body.style.cursor="auto",E[1].style.cursor="pointer",E[1].addEventListener("click",H)),m.includes("comp")&&(document.body.style.cursor="wait",E[1].style.cursor="wait",P())}),[m]),Object(a.useEffect)((function(){return B&&setTimeout((function(){return k(null)}),2e3)}),[B]),Object(a.useEffect)((function(){!C&&h(S.getState().length+1),C&&w(!1)}),[c]),Object(j.jsxs)("div",{children:[Object(j.jsxs)("div",{className:"time-machine--box",children:[b>1&&Object(j.jsx)("button",{className:"time-machine--back",onClick:function(){document.querySelector(".App").classList.toggle("darken"),setTimeout((function(){document.querySelector(".App").classList.toggle("darken")}),1e3),w(!0),S.dispatch({type:"TURN_BACK",payload:b-1});var e=S.getState().map((function(e){return JSON.parse(e)})),t=e[e.length-1],n=Object(s.a)(t.playerBF),a=Object(s.a)(t.compBF);p(n),o(a),h((function(e){return e-1})),"player"!==m&&f("player")},children:"\u276e"}),Object(j.jsx)("div",{className:"turn-counter",children:b})]}),Object(j.jsxs)("div",{className:"war-info",children:["begin"===m&&t[i].begin,"player"===m&&t[i].playerTurn,m.includes("comp")&&t[i].compTurn,"winComp"===m&&t[i].winComp.toUpperCase(),"winPlayer"===m&&t[i].winPlayer.toUpperCase(),"\xa0","playerHits"===B&&t[i].playerHits,"playerMissed"===B&&t[i].playerMissed,"compHits"===B&&t[i].compHits,"compMissed"===B&&t[i].compMissed]})]})}function N(){var e=Object(a.useContext)(g),t=e.message,n=e.lang,r=e.setLang,i=e.arrangeShips,c=e.playerBF,s=e.compBF;return Object(j.jsxs)("div",{className:"wrap",children:[Object(j.jsx)("button",{className:"btn-lang",onClick:function(e){e.target.classList.toggle("lang-en"),r("ru"===n?"en":"ru"),e.target.className.includes("lang-en")?document.title=t.en.gameTitle:document.title=t.ru.gameTitle}}),Object(j.jsx)("h1",{className:"app-title",children:t[n].gameTitle}),Object(j.jsxs)("div",{className:"container",children:[Object(j.jsxs)("div",{className:"battlefield",children:[Object(j.jsx)(C,{type:"digits"}),Object(j.jsx)(C,{type:"letters"}),Object(j.jsx)("div",{className:"battlefield-pad",children:10===c.length&&c.flat().map((function(e){return Object(j.jsx)("span",{className:+e===e?"shipEl":"D"===e?"deadarea":"X"===e?"hit":"empty",children:"*"===e&&e},v()())}))})]}),i&&Object(j.jsx)(S,{}),!i&&Object(j.jsxs)("div",{className:"battlefield battlefield--comp",children:[Object(j.jsx)(C,{type:"digits"}),Object(j.jsx)(C,{type:"letters"}),Object(j.jsx)("div",{className:"battlefield-pad",children:10===s.length&&s.flat().map((function(e){return Object(j.jsx)("span",{className:"X"===e?"hit":"empty",children:"*"===e&&e},v()())}))})]})]}),!i&&Object(j.jsx)(w,{}),Object(j.jsx)("footer",{className:"footer",children:Object(j.jsx)("a",{className:"footer__link",href:"https://github.com/g5-freemen",children:"Made by Anton Borkovskij, 2021"})})]})}var M=n(11);var B=Object(M.a)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return"ADD_TURN"===t.type?[].concat(Object(s.a)(e),[t.payload]):"TURN_BACK"===t.type?Object(s.a)(e).filter((function(e,n){return n<t.payload})):Object(s.a)(e)}));function k(){return Object(j.jsx)(O,{children:Object(j.jsx)("div",{className:"App",children:Object(j.jsx)(N,{})})})}c.a.render(Object(j.jsx)(k,{}),document.getElementById("root"))}},[[21,1,2]]]);
//# sourceMappingURL=main.5d0823b6.chunk.js.map