(this["webpackJsonpsea-battle"]=this["webpackJsonpsea-battle"]||[]).push([[0],{15:function(e,t,n){},16:function(e,t,n){},18:function(e,t,n){"use strict";n.r(t);var i=n(1),a=n.n(i),c=n(9),r=n.n(c),s=(n(15),n(16),n(10)),l=n(4),o=n(2),u=n(6),d=n.p+"static/media/hit.8c96d676.mp3",p=n.p+"static/media/miss.b9a5893c.mp3",b=n.p+"static/media/fight.15e2f926.mp3",f=n.p+"static/media/winComp.f369007a.mp3",j=n.p+"static/media/winPlayer.4834e938.mp3",m=n(0),h=a.a.createContext({}),O=h.Provider;function g(e){var t=e.children,n=Object(i.useState)(!0),a=Object(o.a)(n,2),c=a[0],r=a[1],h=Object(i.useState)("begin"),g=Object(o.a)(h,2),y=g[0],v=g[1],x=Object(i.useState)(Array(10).fill("-").map((function(){return Array(10).fill("-")}))),C=Object(o.a)(x,2),S=C[0],w=C[1],M=Object(i.useState)(Array(10).fill("-").map((function(){return Array(10).fill("-")}))),N=Object(o.a)(M,2),B=N[0],F=N[1],R=Object(i.useState)({}),k=Object(o.a)(R,2),A=k[0],E=k[1],P=Object(i.useState)(null),T=Object(o.a)(P,2),H=T[0],X=T[1],D=Object(i.useState)(null),q=Object(o.a)(D,2),Y=q[0],I=q[1],J=Object(i.useState)("begin"),L=Object(o.a)(J,2),U=L[0],W=L[1],_=[[1,4],[2,3],[3,2],[4,1]],z={playerTurn:"\u0412\u0430\u0448 \u0445\u043e\u0434!",compTurn:"\u0425\u043e\u0434 \u043a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440\u0430!",begin:"\u0414\u0430 \u043d\u0430\u0447\u043d\u0451\u0442\u0441\u044f \u0431\u0438\u0442\u0432\u0430!",playerHits:"\u0412\u044b \u043f\u043e\u043f\u0430\u043b\u0438!",playerMissed:"\u0412\u044b \u043f\u0440\u043e\u043c\u0430\u0445\u043d\u0443\u043b\u0438\u0441\u044c!",compHits:"\u041a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440 \u043f\u043e\u043f\u0430\u043b!",compMissed:"\u041a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440 \u043f\u0440\u043e\u043c\u0430\u0445\u043d\u0443\u043b\u0441\u044f!",winPlayer:"\u0412\u044b \u043f\u043e\u0431\u0435\u0434\u0438\u043b\u0438!".toUpperCase(),winComp:"\u041a\u043e\u043c\u043f\u044c\u044e\u0442\u0435\u0440 \u043f\u043e\u0431\u0435\u0434\u0438\u043b!".toUpperCase()},G=Object(u.a)(d),K=Object(o.a)(G,1)[0],Q=Object(u.a)(p),V=Object(o.a)(Q,1)[0],Z=Object(u.a)(b),$=Object(o.a)(Z,1)[0],ee=Object(u.a)(f),te=Object(o.a)(ee,1)[0],ne=Object(u.a)(j),ie=Object(o.a)(ne,1)[0];function ae(e){var t={top:e.top,bottom:e.bottom,left:e.left,right:e.right,width:e.width,height:e.height,gridCol:new Array(11).fill(0).map((function(t,n){return e.left+n*e.width/10})),gridRow:new Array(11).fill(0).map((function(t,n){return e.top+n*e.height/10}))};E(t)}return Object(i.useEffect)((function(){var e=document.querySelector(".battlefield-pad").getBoundingClientRect();!function(e){var t,n=0,i=Object(s.a)(e);try{for(i.s();!(t=i.n()).done;)for(var a=t.value,c=function(e){var t={num:n++,length:a[1]};X((function(e){return e?e.concat(t):[t]})),I((function(e){return e?e.concat(t):[t]}))},r=0;r<a[0];r++)c()}catch(l){i.e(l)}finally{i.f()}}(_),ae(e)}),[]),Object(i.useEffect)((function(){!1===c&&ae(document.querySelectorAll(".battlefield-pad")[1].getBoundingClientRect())}),[c]),Object(m.jsx)(O,{value:{arrangeShips:c,setArrangeShips:r,arrangeShipsMode:y,setArrangeShipsMode:v,playerBF:S,setPlayerBF:w,compBF:B,setCompBF:F,playerShips:H,setPlayerShips:X,compShips:Y,setCompShips:I,bfCoord:A,message:z,turn:U,setTurn:W,getRnd:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;e<1||e>10;)e=Math.ceil(10*Math.random());return e},playHit:K,playMiss:V,playFight:$,checkWinner:function(){(U.includes("comp")||U.includes("player"))&&(0===Object(l.a)(S).flat().filter((function(e){return e===+e})).length&&(te(),W("winComp")),0===Object(l.a)(B).flat().filter((function(e){return e===+e})).length&&(ie(),W("winPlayer")))}},children:t})}var y=n(3),v=n.n(y);function x(e){var t=e.length,n=e.num,c=Object(i.useContext)(h),r=c.setPlayerShips,s=(c.compShips,c.setCompShips),u=c.compBF,d=c.setCompBF,p=c.bfCoord,b=c.playerBF,f=c.setPlayerBF,j=c.arrangeShipsMode,O=c.getRnd,g=Object(i.useState)("auto"===j&&Math.random()>.5),y=Object(o.a)(g,2),x=y[0],C=y[1];function S(e,i,a,c){for(var o=!0,p=0;p<t;p++)try{c?(x||"-"===u[i-1][e-1+p]||(o=!1),x&&"-"!==u[i-1+p][e-1]&&(o=!1)):(x||"-"===b[i-1][e-1+p]||(o=!1),x&&"-"!==b[i-1+p][e-1]&&(o=!1))}catch(M){o=!1}if(o){for(var m=c?Object(l.a)(u):Object(l.a)(b),h=0;h<t;h++)x?m[i-1+h][e-1]=n:m[i-1][e-1+h]=n;for(var g=0;g<3;g++)for(var y=0;y<t+2;y++){var v=void 0,C=void 0;if(x?(v=i-2+y,C=e-2+g):(v=i-2+g,C=e-2+y),!(v<0||C<0||v>9||C>9)){var w=m[v][C];void 0!==w&&w!==+w&&"D"!==w&&(m[v][C]="D")}}c?(d(m),s((function(e){return e.filter((function(e){return e.num!==n}))}))):(f(m),r((function(e){return e.filter((function(e){return e.num!==n}))}))),document.onmousemove=null,a&&(a.onmouseup=null)}o||(c||"auto"!==j?c&&S(O(),O(),null,!0):S(O(),O(),null))}return Object(i.useEffect)((function(){"auto"===j&&setTimeout((function(){b.toString().includes(n)||S(O(),O(),null)}),500*n),u.toString().includes(n)||S(O(),O(),null,!0)}),[b,u]),Object(m.jsxs)(a.a.Fragment,{children:[Object(m.jsx)("span",{className:"ship",id:v()(),style:x?{width:33,height:33*t}:{width:33*t,height:33},onDragStart:function(){return!1},onMouseDown:function(e){if(0===e.button){var t=e.target,n=t.getBoundingClientRect(),i=e.pageX-n.left,a=e.pageY-n.top;t.style.position="absolute",t.style.zIndex=9,c(e),document.onmousemove=function(e){return c(e)},t.onmouseup=function(e){for(var n,i,a=e.target.closest(".ship").getBoundingClientRect(),c=0;c<p.gridCol.length-1;c++)a.x>=p.gridCol[c]&&a.x<=p.gridCol[c+1]&&(n=c+1),a.y>=p.gridRow[c]&&a.y<=p.gridRow[c+1]&&(i=c+1);void 0===n||void 0===i||n<1||i<1||"auto"!==j&&S(n,i,t)}}function c(e){t.style.left=e.pageX-i+"px",t.style.top=e.pageY-a+"px"}},onContextMenu:function(e){e.preventDefault(),C((function(e){return!e}))},children:n}),Object(m.jsx)("span",{className:"ship-margin"})]},v()())}function C(){var e=Object(i.useContext)(h),t=e.playerShips,n=e.arrangeShipsMode,a=e.setArrangeShipsMode,c=e.setArrangeShips;return document.addEventListener("keydown",(function(e){"1"===e.key?a("manual"):"2"===e.key&&a("auto")})),Object(i.useEffect)((function(){t&&0===t.length&&a("playerReady")}),[t]),Object(i.useEffect)((function(){"playerReady"===n&&c(!1)}),[n]),Object(m.jsxs)("div",{className:"battlefield-menu",children:[("begin"===n||"manual"===n||"auto"===n)&&Object(m.jsxs)("p",{className:"battlefield-menu--title",children:["\u0420\u0430\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0430 \u043a\u043e\u0440\u0430\u0431\u043b\u0435\u0439","manual"===n&&Object(m.jsx)("span",{children:": \u0432\u0440\u0443\u0447\u043d\u0443\u044e"}),"auto"===n&&Object(m.jsx)("span",{children:": \u0430\u0432\u0442\u043e"})]}),"manual"===n&&Object(m.jsxs)("span",{className:"battlefield-menu--remark",children:["\u041a\u043b\u0438\u043a\u043d\u0438\u0442\u0435 \u043d\u0430 \u043a\u043e\u0440\u0430\u0431\u043b\u044c \u043b\u0435\u0432\u043e\u0439 \u043a\u043d\u043e\u043f\u043a\u043e\u0439 \u043c\u044b\u0448\u0438 \u0447\u0442\u043e\u0431\u044b \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0435\u0433\u043e",Object(m.jsx)("br",{}),"\u041a\u043b\u0438\u043a\u043d\u0438\u0442\u0435 \u043d\u0430 \u043a\u043e\u0440\u0430\u0431\u043b\u044c \u043f\u0440\u0430\u0432\u043e\u0439 \u043a\u043d\u043e\u043f\u043a\u043e\u0439 \u043c\u044b\u0448\u0438 \u0447\u0442\u043e\u0431\u044b \u043f\u043e\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u0435\u0433\u043e"]}),"begin"===n&&Object(m.jsxs)("ul",{className:"battlefield-menu--list",children:[Object(m.jsx)("li",{onClick:function(){return a("manual")},children:" 1) \u0412\u0440\u0443\u0447\u043d\u0443\u044e "}),Object(m.jsx)("li",{onClick:function(){return a("auto")},children:" 2) \u0410\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 "})]}),("manual"===n||"auto"===n)&&Object(m.jsx)("div",{className:"battlefield-menu--ships",children:t.map((function(e){return Object(m.jsx)(x,{length:e.length,num:e.num},v()())}))})]})}function S(e){var t=e.type;return Object(m.jsx)("div",{className:"battlefield-"+t,children:[1,2,3,4,5,6,7,8,9,10].map((function(e){return Object(m.jsx)("span",{className:"idx",style:"digits"===t?{gridColumn:e}:{gridRow:e},children:"digits"===t?e:10!==e?String.fromCharCode(e+1039):"\u041a"},v()())}))})}function w(){var e=Object(i.useContext)(h),t=e.message,n=e.bfCoord,a=e.compBF,c=e.setCompBF,r=e.playerBF,s=e.setPlayerBF,u=e.getRnd,d=e.turn,p=e.setTurn,b=e.checkWinner,f=e.playHit,j=e.playMiss,O=e.playFight,g=Object(i.useState)(null),y=Object(o.a)(g,2),x=y[0],C=y[1];function S(e,t){e&&t||(e=u(),t=u());var n="player"===d?Object(l.a)(a):Object(l.a)(r),i=n[t-1][e-1];return+i===i?(n[t-1][e-1]="X",f(),"player"===d?c(n):s(n),C("player"===d?"playerHits":"compHits"),void("comp"===d&&setTimeout((function(){p("comp "+v()())}),999))):"X"===i||"*"===i?void(d.includes("comp")&&p("comp "+v()())):(n[t-1][e-1]="*",j(),"player"===d?c(n):s(n),C("player"===d?"playerMissed":"compMissed"),void setTimeout((function(){p("player"===d?"comp":"player")}),999))}return Object(i.useEffect)((function(){"begin"===d&&(O(),setTimeout(p.bind(null,"player"),2e3)),b(),console.log("turn=",d);var e=document.querySelectorAll(".battlefield-pad");d.includes("player")&&(document.body.style.cursor="auto",e[1].style.cursor="pointer",e[1].addEventListener("click",(function(e){for(var t,i,a=e.clientX,c=e.clientY,r=0;r<n.gridCol.length-1;r++)a>=n.gridCol[r]&&a<=n.gridCol[r+1]&&(t=r+1),c>=n.gridRow[r]&&c<=n.gridRow[r+1]&&(i=r+1);S(t,i)}))),d.includes("comp")&&(document.body.style.cursor="wait",e[1].style.cursor="wait",S())}),[d]),Object(i.useEffect)((function(){x&&setTimeout(C.bind(null,null),2e3)}),[x]),Object(m.jsxs)("div",{className:"war-info",children:["begin"===d&&t.begin,d.includes("player")&&t.playerTurn,d.includes("comp")&&t.compTurn,"winComp"===d&&t.winComp,"winPlayer"===d&&t.winPlayer,"\xa0","playerHits"===x&&t.playerHits,"playerMissed"===x&&t.playerMissed,"compHits"===x&&t.compHits,"compMissed"===x&&t.compMissed]})}function M(){var e=Object(i.useContext)(h),t=e.arrangeShips,n=e.playerBF,c=e.compBF;return Object(m.jsxs)(a.a.Fragment,{children:[Object(m.jsxs)("div",{className:"container",children:[Object(m.jsxs)("div",{className:"battlefield",children:[Object(m.jsx)(S,{type:"digits"}),Object(m.jsx)(S,{type:"letters"}),Object(m.jsx)("div",{className:"battlefield-pad",children:10===n.length&&n.flat().map((function(e){return Object(m.jsx)("span",{className:+e===e?"shipEl":"D"===e?"deadarea":"X"===e?"hit":"empty",children:"*"===e&&e},v()())}))})]}),t&&Object(m.jsx)(C,{}),!t&&Object(m.jsxs)("div",{className:"battlefield battlefield--comp",children:[Object(m.jsx)(S,{type:"digits"}),Object(m.jsx)(S,{type:"letters"}),Object(m.jsx)("div",{className:"battlefield-pad",children:10===c.length&&c.flat().map((function(e){return Object(m.jsx)("span",{className:"X"===e?"hit":"empty",children:"*"===e&&e},v()())}))})]})]}),!t&&Object(m.jsx)(w,{}),Object(m.jsx)("footer",{className:"footer",children:Object(m.jsx)("a",{className:"footer__link",href:"https://github.com/g5-freemen",children:"Made by Anton Borkovskij, 2021"})})]})}function N(){return Object(m.jsx)(g,{children:Object(m.jsxs)("div",{className:"App",children:[Object(m.jsx)("h1",{className:"app-title",children:"\u041c\u043e\u0440\u0441\u043a\u043e\u0439 \u0431\u043e\u0439"}),Object(m.jsx)(M,{})]})})}r.a.render(Object(m.jsx)(a.a.StrictMode,{children:Object(m.jsx)(N,{})}),document.getElementById("root"))}},[[18,1,2]]]);
//# sourceMappingURL=main.67f76904.chunk.js.map